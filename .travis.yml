#sudo: required
group: travis_lts
env:
  global:
    TERM=dumb
language: java
jdk:
- openjdk8
- oraclejdk8
#service:
#- docker
install: true
before_script:
- sudo apt update -y || true
- sudo apt -y install curl
#- sudo apt -y install docker-ce python-pip
- sudo pip install httpie
- source <(curl -fsSL https://raw.github.com/daggerok/bash-functions/master/main.bash)
script:
#- bash mvnw

#- bash mvnw clean package -DskipTests

#- >
#  bash mvnw clean package \
#    -pl integration-simple \
#    -pl integration-simple-load-balancer \
#    -pl embedded-kafka \
#    -pl durable-pubsub-consumer \
#    -pl durable-pubsub-producer \
#    -pl consumer-groups-consumer1 \
#    -pl consumer-groups-consumer2 \
#    -pl consumer-groups-producer

# maven exclude / skip / ignore module from build
- bash mvnw clean package -pl !spring-cloud-stream-simple-consumer,!spring-cloud-stream-simple-producer

- bash mvnw spring-boot:run -pl embedded-kafka &
- wait_for 8001
- bash mvnw spring-boot:run -pl durable-pubsub-producer &
- wait_for 8002
- http post :8002/api/v1/send message=ololo
- http post :8002/api/v1/send message=trololo
- stop_any 8002
- bash mvnw spring-boot:run -pl durable-pubsub-consumer &
- wait_for 8003
- sleep 1
- stop_any 8002 8001

- bash mvnw spring-boot:run -pl embedded-kafka &
- wait_for 8001
- bash mvnw spring-boot:run -pl consumer-groups-consumer1 &
- bash mvnw spring-boot:run -pl consumer-groups-consumer2 &
- bash mvnw spring-boot:run -pl consumer-groups-producer &
- wait_for 8004 8005 8006
- http post :8006/api/v1/send message='ololololo ololo ololo'
- http post :8006/api/v1/send message=trololololo\ trololo\ trlolo
- stop_any 8004 8005 8006 8001

- bash mvnw spring-boot:run -pl embedded-kafka &
- wait_for 8001
- bash mvnw clean package -pl spring-cloud-stream-simple-consumer,spring-cloud-stream-simple-producer
- bash mvnw spring-boot:run -pl spring-cloud-stream-simple-consumer
- bash mvnw spring-boot:run -pl spring-cloud-stream-simple-producer
- wait_for 8005 8006
- http :8006 message=hey!
- http :8006 message=ho!
- stop_any 8006 8005 8001

cache:
  directories:
  - $HOME/.m2/
  - $HOME/.gradle/
